<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link
      type="text/css"
      rel="stylesheet"
      href="styles/prettify-tomorrow.css"
    />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css" />
  </head>

  <body>
    <div id="main">
      <h1 class="page-title">Source: main.js</h1>

      <section>
        <article>
          <pre
            class="prettyprint source linenums"
          ><code>// main.js – Start der Anwendung. Baut Oberfläche und reagiert auf Login-Änderungen.
/**
 * @fileoverview Projekt Einstiegspunkt für Join (Kanban Project Management Tool).
 * @module main
 * @project Join
 * @version 1.0.0
 * @license MIT
 * @description Join ist ein leichtgewichtiges Kanban / Task- und Kontakt-Management Tool. Es nutzt Vanilla ES Modules (kein Framework) und Firebase Authentication für Benutzerverwaltung. Die App rendert nach Login eine Shell (Header, Sidebar, Main) und zeigt ein Summary-Dashboard. Weitere Ansichten (Board, Contacts, Add Task) werden modular eingebunden (Platzhalter für zukünftige Implementierung in dieser Iteration).
 * Architektur:
 *  - Multi‑Page Application Struktur (mehrere HTML Dateien) + dynamische Komponenten
 *  - Auth Layer: Firebase oder Gast-Session (sessionStorage)
 *  - UI Komponenten: header.js, sidebar.js, summary.js
 *  - Erweiterbar für Firestore / Realtime DB (derzeit nur Auth aktiv)
 * Code-Guidelines:
 *  - Kurze Funktionen (Single Responsibility)
 *  - Deutsche JSDoc Kurzformen, englische Identifier
 *  - Escape / Sicherheitsmaßnahmen bei dynamischer Ausgabe (z.B. escapeHtml)
 *
 * Wichtige Module:
 *  - main.js: Einstieg / Zustandsumschaltung (Login &lt;-> App Shell)
 *  - auth.js: Authentifizierung + Signup Flow
 *  - summary.js: Dashboard (statische Kennzahlen + Begrüßung)
 *  - firebase.js: Firebase Initialisierung
 */

import {
  renderHeader,
  initProfileMenu,
  initLogoutLink,
} from "./components/header.js";
import { renderSidebar, setActiveNav } from "./components/sidebar.js";
import { auth, isUserLoggedIn } from "./firebase.js";
import { getActiveUser, attachLoginFormHandlers } from "./auth.js";
import { renderSummaryView } from "./components/summary.js"; // Ausgelagert: Rendert statische Summary-Kachelstruktur
import { renderAddTaskComponent } from "./components/addTask.js";
import { renderPrivacyPolicyView } from "./components/privacyPolicyView.js";
import { renderBoardView } from "./components/board.js";
import { ContactsComponent } from "./components/contacts.js";

// Haupt-Container aus dem HTML holen
const appRoot = document.getElementById("app");

/**
 * Gibt das Grund-Layout zurück (Header-Container, Sidebar-Container, Main-Container).
 * @function renderBaseLayout
 * @returns {string} HTML-Markup für das Grundgerüst
 */
function renderBaseLayout() {
  return /*html*/ `
  &lt;div class="layout">
    &lt;div id="layout-header">&lt;/div>
    &lt;aside id="layout-sidebar">&lt;/aside>
    &lt;main id="layout-main" class="main__container" tabindex="-1">&lt;/main>
  &lt;/div>`;
}

/**
 * Erzeugt das HTML für die Login-Ansicht (Login / Gast / Sign‑Up).
 * @function renderLoginView
 * @returns {string} HTML-Markup des Login Screens
 */
function renderLoginView() {
  return `
  &lt;div class="login-header-signup">
    &lt;div class="signup-text">Not a Join user?&lt;/div>
    &lt;button class="btn btn-signup" id="signupBtn">Sign up&lt;/button>
  &lt;/div>
  &lt;div class="login-view-wrapper">
    &lt;div class="login-card" role="main" aria-labelledby="loginTitle">
      &lt;div class="login-logo-fixed">&lt;img src="./img/icon/logo.svg" alt="Join Logo" />&lt;/div>
      &lt;div class="login-header">&lt;h1 id="loginTitle">Login &lt;/h1>&lt;/div>
      &lt;div>
        &lt;div class="signUp__separator_login" aria-hidden="true">&lt;/div>
      &lt;/div>
      &lt;form class="login-form" id="loginForm" novalidate>
        &lt;div class="inputField__container inputField__container-margin24">
          &lt;input id="email" type="email" name="email" placeholder="E-Mail" autocomplete="email" required oninput="validateEmail()">
          &lt;img class="inputField__username__icon" src="./img/icon/mail.svg" alt="Email">
        &lt;/div>
        &lt;div class="inputField__container inputField__container-margin24">
          &lt;input id="password" type="password" name="password" placeholder="Passwort" autocomplete="current-password" required oninput="validatePassword()">
          &lt;img class="inputField__password__icon" src="./img/icon/lock.svg" alt="Passwort">
        &lt;/div>
        &lt;div class="login-status" id="loginStatus" aria-live="polite">&lt;/div>
        &lt;div class="login-actions">
          &lt;button type="submit" class="btn btn-primary" id="loginBtn">Login&lt;/button>
          &lt;button type="button" class="btn btn-outline" id="guestBtn">Gastzugang&lt;/button>
        &lt;/div>
      &lt;/form>
    &lt;/div>
  &lt;/div>
  &lt;footer class="login-footer">
    &lt;button type="button" onclick="window.location.href='./pages/privacy_policy_external.html'">Privacy Policy&lt;/button>
    &lt;button type="button" onclick="window.location.href='./pages/legal_notice_external.html'">Legal Notice&lt;/button>
  &lt;/footer>
  `;
}

/**
 * Liefert Initialen (1–2 Buchstaben) für den Profilkreis aus DisplayName oder E-Mail.
 * @function getInitialsFromUser
 * @param {Object} user Firebase User oder Gastobjekt
 * @returns {string} 1–2 Großbuchstaben
 */
function getInitialsFromUser(user) {
  if (!user) return "GU";
  if (user.displayName) {
    return user.displayName
      .split(/\s+/)
      .filter(Boolean)
      .map((p) => p[0].toUpperCase())
      .slice(0, 2)
      .join("");
  }
  if (user.email) return user.email[0].toUpperCase();
  return "US";
}

/**
 * Rendert die komplette App-Shell (Header, Sidebar) und zeigt die Summary.
 * @function mountShell
 * @fires auth-changed (indirekt über andere Module)
 * @returns {void}
 */
function mountShell() {
  const user = getActiveUser();
  appRoot.innerHTML = renderBaseLayout();
  document.getElementById("layout-header").innerHTML = renderHeader(
    getInitialsFromUser(user)
  );
  const sidebarMount = document.getElementById("layout-sidebar");
  if (sidebarMount) sidebarMount.innerHTML = renderSidebar();
  initProfileMenu();
  initLogoutLink();
  setActiveNav(window.location.hash || "#summary");
  renderSummaryView();
}

/**
 * Initialisiert Listener für Firebase Auth sowie eigenes auth-changed Event.
 * @function initAuthListener
 * @listens auth-changed
 * @returns {void}
 */
function initAuthListener() {
  import("https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js").then(
    ({ onAuthStateChanged }) => {
      onAuthStateChanged(auth, () => {
        updateUIFromAuth();
      });
    }
  );
  window.addEventListener("auth-changed", () => updateUIFromAuth());
}

/**
 * Aktualisiert die Oberfläche abhängig vom aktuellen Auth-Status (zeigt Login oder Shell).
 * @function updateUIFromAuth
 * @returns {void}
 */
function updateUIFromAuth() {
  const user = getActiveUser();
  if (user) {
    // Wenn bereits Layout existiert, nur Initialen &amp; Summary aktualisieren
    if (!document.getElementById("layout-header")) {
      mountShell();
    } else {
      const initialsEl = document.getElementById("profileInitials");
      if (initialsEl) initialsEl.textContent = getInitialsFromUser(user);
      renderSummaryView();
    }
  } else {
    // Login-View + Brand Splash
    appRoot.innerHTML = `
  &lt;div class="brand-splash" id="brandSplash">&lt;img src="./img/img/header_logo.svg" alt="Join Logo" />&lt;/div>
      ${renderLoginView()}`;
    const card = appRoot.querySelector(".login-card");
    if (card) card.classList.add("login-card-hidden");
    attachLoginFormHandlers(document);

    // Transition Logo in Ecke und danach Login Card einblenden
    requestAnimationFrame(() => {
      const splash = document.getElementById("brandSplash");
      if (splash) {
        // leichte Verzögerung für Start
        setTimeout(() => {
          splash.classList.add("brand-fixed");
          // Nach Bewegung (700ms) Card einblenden (länger warten, damit Logo-Animation komplett ist)
          setTimeout(() => {
            if (card) card.classList.remove("login-card-hidden");
            if (card) card.classList.add("login-card-shown");
          }, 900);
          // Splash als separates Element behalten (Logo bleibt als Mini-Variante sichtbar)
        }, 80);
      }
    });
  }
}

// App starten
updateUIFromAuth();
initAuthListener();

window.addEventListener("hashchange", () => {
  setActiveNav(window.location.hash || "#summary");
});

// Platz für weiteres Routing

function renderViewFromHash() {
  const hash = window.location.hash || "#summary";
  setActiveNav(hash);

  switch (hash) {
    case "#board":
      renderBoardView(document.getElementById("layout-main") || appRoot);
      break;
    case "#privacy":
      renderPrivacyPolicyView(
        document.getElementById("layout-main") || appRoot
      );
      break;
    case "#add-task": {
      const main = document.getElementById("layout-main") || appRoot;
      if (main) main.innerHTML = renderAddTaskComponent();
      break;
    }
    case "#contacts": {
      const main = document.getElementById("layout-main") || appRoot;
      if (main) main.innerHTML = ContactsComponent();
      break;
    }
    case "#summary":
    default:
      renderSummaryView(document.getElementById("layout-main") || appRoot);
      break;
  }
}

window.addEventListener("hashchange", () => {
  renderViewFromHash();
});
</code></pre>
        </article>
      </section>
    </div>

    <nav>
      <h2><a href="index.html">Home</a></h2>
      <h3>Modules</h3>
      <ul>
        <li><a href="module-auth.html">auth</a></li>
        <li><a href="module-firebase.html">firebase</a></li>
        <li><a href="module-main.html">main</a></li>
      </ul>
      <h3>Global</h3>
      <ul>
        <li><a href="global.html#checkBoxClicked">checkBoxClicked</a></li>
        <li>
          <a href="global.html#deleteMessageThatPasswordsDontMatch"
            >deleteMessageThatPasswordsDontMatch</a
          >
        </li>
        <li>
          <a href="global.html#disableSignupButtonIfFormIsEmpty"
            >disableSignupButtonIfFormIsEmpty</a
          >
        </li>
        <li><a href="global.html#showPassword">showPassword</a></li>
        <li><a href="global.html#signUpSubmit">signUpSubmit</a></li>
        <li><a href="global.html#validateEmail">validateEmail</a></li>
        <li><a href="global.html#validatePassword">validatePassword</a></li>
      </ul>
    </nav>

    <br class="clear" />

    <footer>
      Documentation generated by
      <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Oct 01
      2025 09:48:01 GMT+0200 (Mitteleuropäische Sommerzeit)
    </footer>

    <script>
      prettyPrint();
    </script>
    <script src="scripts/linenumber.js"></script>
  </body>
</html>
